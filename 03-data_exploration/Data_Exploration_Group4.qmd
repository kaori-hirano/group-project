---
title: "Data Exploration"
author: "Group 4"
date: "7/6/2023"
format: pdf
execute: 
  warning: false
  message: false
editor: 
  markdown: 
    wrap: 72
---
```{r libraries}
# loads all needed libraries
library(dplyr)
library(tidyr)
library(readxl)
library(tidyverse)
library(reshape2)
```

# Exploring the Data
What is your outcome variable(s)? How well does it measure the outcome you are 
interested in? How does it relate to your hypotheses? What are your key 
explanatory variables? In addition, create a table of summary statistics for 
the variables you are planning to use.

General Answer: Our outcome variable is 
civil society participation, which is v2x_cspart in the code. 

We will use the predictor variables listed above, which include: 
civil society repression effort scores,  v2csreprss
social support scores,  happiness
freedom to make life choices,  happiness
presence of war, e_civil_war
presence of coups, e_pt_coup
participation rate in civil society, v2x_partipdem
generosity, happiness
education, e_peaveduc
and government corruption. v2x_corr

## Merging data - James
```{r load-data}
wh_2023 <- read_excel("/cloud/project/data/wh_2023.xls")
# View(wh_2023)

load("/cloud/project/data/vdemdata-master/data/vdem.RData")

# colnames(wh_2023)
# colnames(vdem)
```

```{r data processing(merge)}
need_vdem=c("country_name","year","v2csreprss",'e_civil_war',"e_pt_coup",
"v2x_partipdem","e_peaveduc","v2x_corr","v2x_cspart","v2xcs_ccsi")

vdem_use=vdem[,need_vdem]

need_wh=c("Country name","year","Social support","Freedom to make life choices","Generosity")
wh_use=wh_2023[,need_wh]

colnames(wh_use)[1] <- "country_name"

total=merge(vdem_use, wh_use, by = c("country_name", "year"),
            all.x=TRUE,
            all.y=TRUE) 
```

## Cleaning data - Alicia 
- Count how many NA observations we have. If it is under %, we will omit the obs.
or we could assign some values to them using given method.
- Drop columns not needed
- Rename the columns based on the code book

- Histograms and box plots 
- Create a table of summary statistics for the variables you are planning to use.

### these questions need to be answered
What data cleaning did you have to do?
How did you wrangle the data?
Are you deciding to exclude any observations? If so, why?
Did you have to create any new variables from existing variables? If so, how and why?

```{r data-cleaning}
# changing the NA entries with a median of that column
summary(total)
total_not_NA <- total %>% na.omit() 
# Because we are missing too many observations when we drop NAs, we will assign
# median of each column to the NA values instead

# We might need a different method for e_civil_war 
# because it is all binary 0 and 1
# remove the column from the set of columns parsed in the mutate function below
total$e_civil_war <- as.character(total$e_civil_war)
total$e_pt_coup <- as.numeric(total$e_pt_coup)

#replace missing values in each numeric column with median value of column
new_total <- total %>% mutate(across(where(is.numeric),~replace_na(.,median(.,na.rm=TRUE))))

# convert the e_civil_war and e_pt_coup columns to get summary()
new_total$e_civil_war <- as.numeric(new_total$e_civil_war)

# Get the summary of our combined data set
summary_table <- summary(new_total)
summary_table

# Get the summary of the e_civil_war variable
new_total %>% group_by(e_civil_war) %>% count()

# Boxplots and Histograms
# Draw boxplots for each column
selected <- new_total %>% select(-c(country_name, e_civil_war))

# Need to add labels to plots
# Need to change axis scale
lapply(selected, function(x) boxplot(x, main = colnames(selected)[which(colnames(selected) == names(x))]))

# Draw histograms for each column
# Need to add labels to plots
# Need to change axis scale
lapply(selected, function(x) hist(x, main = colnames(selected)[which(colnames(selected) == names(x))]))
```

```{r outlier-removal}

#Replacing the outliers of a particular column with median

## you'll probably want to include why you chose the ones you did 

vec1<-boxplot.stats(data$Dist_Taxi)$out;
data$Dist_Taxi[data$Dist_Taxi %in% vec1]<-median(data$Dist_Taxi)
```

## Code book - README.qmd - Kaori
- updated in the data folder and this folder

## Data Visualization - Ephrata and Kaori 
### How well does it measure the outcome you are interested in? - Kaori

We chose civil society participation as our outcome variable. We were originally
going to use civil society index, but we were not able to find much information 
regarding the actual measures considered, so we chose to use civil society participation
instead. This is because civil society index may have already considered factors we
are adding to the model, while civil society participation will tell us how many 
people are actually participating in civil society, which is the public sphere between
the private sphere and government, which can include professional organizations, 
charities, labor unions, and spiritual groups. 

### What is our hypothesis? - Kaori
Our hypothesis is that countries with similar characteristics regarding supporting/
not supporting civil society--such as the presences of war or good educational 
systems--will have similar civil society participation rates. 

### How do our variable choices relate to our hypotheses? - Kaori 
Our choices of variables reflect our understanding of civil society and the factors
that make it stronger or weaker. Things that bring people together, such as generosity, 
and things that may bring people apart, such as corruption, we expect to have an 
effect on participation in civil society, which is why they are included. Civil 
society repression effort is included because we expect higher repression efforts 
to have an effect on participation in general, likely negative. This is considered
in the civil society index, but will be used in preliminary analysis for better 
understanding and exploration of the topic. Social support we 
expect to have a positive relationship with civil society participation because 
people will be connected with each other, and the same applies to generosity, with
the opposite logic applying to presence of war and coups. Civil society index is 
included because we expect a stronger civil society to have a stronger participation 
rate, as with education because schools and teaching organizations often are a 
large part of civil society. The civil society index takes into account the entry/exit
of civil society organizations (CSOs), the repression of civil society, 
and the participatory environment, which is the types and amount of CSOs available. 
Government corruption is included because 
this may dissuade people from participating in civil society or weaken civil
society by underfunding it making people less likely to engage in it. Finally, 
participation in democracy is used because it measures the active level of citizen
participation which considers suffrage, direct democracy, engagement with civil 
society organizations, and subnational elected bodies.


- A correlation heat map - Kaori 
```{r changing-names}
# changes names to shorter and easier to type/remember forms
cs <- new_total %>% rename(csrepress = v2csreprss, civil_war = e_civil_war, coup = e_pt_coup,
                           edu = e_peaveduc, corr = v2x_corr, cspart = v2x_cspart, 
                           cs_index = v2xcs_ccsi, social_support = 'Social support', 
                           choices = 'Freedom to make life choices', gen = Generosity)

cs <- cs %>% filter(year > 2011) # updates to match year for both datasets 
# the full measures for happiness start in 2012, so all years before then are 
# filtered out for the sake of analysis

saveRDS(cs, file = "civil_society")
```

```{r corr-heatmap, fig.width = 20, fig.height = 30}

# plot of civil society participation by country and year
gg <- ggplot(data = cs, aes(x = year, y = country_name, fill = cspart)) +
  geom_tile() + 
  labs(title = "Civil Society Participation by Country Over Year", x = 'Year',
       y = 'Country', fill = 'Civil Society Participation Index') +
  theme(axis.text.y = element_text(face="bold", color="black",  size=5, angle = 45, hjust = 1)) +
  theme(legend.position = 'bottom')
  #options(repr.plot.width = 15, repr.plot.height = 50)

gg
```


Visualization group 2: 
- Scatter plots civil society participation vs. each single predictor - Ephrata
- Line graphs showing changes over time for each predictor vs. outcome - Ephrata
- QQ Plot - Ephrata

```{r Scatter plot}
# Scatter plot of civil society participation vs. civil society repression effort
ggplot(cs, aes(x = csrepress, y = cspart)) +
  geom_point() +
  labs(x = "Civil Society Repression Effort", y = "Civil Society Participation") +
  ggtitle("Civil Society Participation vs. Civil Society Repression Effort")

# Scatter plot of civil society participation vs. social support
ggplot(cs, aes(x = social_support, y = cspart)) +
  geom_point() +
  labs(x = "Social Support", y = "Civil Society Participation") +
  ggtitle("Civil Society Participation vs. Social Support")

# Scatter plot of civil society participation vs. freedom to make life choices
ggplot(cs, aes(x = choices, y = cspart)) +
  geom_point() +
  labs(x = "Freedom to Make Life Choices", y = "Civil Society Participation") +
  ggtitle("Civil Society Participation vs. Freedom to Make Life Choices")

# Scatter plot of civil society participation vs. presence of war
ggplot(cs, aes(x = civil_war, y = cspart)) +
  geom_point() +
  labs(x = "Presence of War", y = "Civil Society Participation") +
  ggtitle("Civil Society Participation vs. Presence of War")

# Scatter plot of civil society participation vs. presence of coups
ggplot(cs, aes(x = coup, y = cspart)) +
  geom_point() +
  labs(x = "Presence of Coups", y = "Civil Society Participation") +
  ggtitle("Civil Society Participation vs. Presence of Coups")

# Scatter plot of civil society participation vs. participation rate in civil society
ggplot(cs, aes(x = v2x_partipdem, y = cspart)) +
  geom_point() +
  labs(x = "Participation Rate in Civil Society", y = "Civil Society Participation") +
  ggtitle("Civil Society Participation vs. Participation Rate in Civil Society")

# Scatter plot of civil society participation vs. generosity
ggplot(cs, aes(x = gen, y = cspart)) +
  geom_point() +
  labs(x = "Generosity", y = "Civil Society Participation") +
  ggtitle("Civil Society Participation vs. Generosity")

# Scatter plot of civil society participation vs. education
ggplot(cs, aes(x = edu, y = cspart)) +
  geom_point() +
  labs(x = "Education", y = "Civil Society Participation") +
  ggtitle("Civil Society Participation vs. Education")

# Scatter plot of civil society participation vs. government corruption
ggplot(cs, aes(x = corr, y = cspart)) +
  geom_point() +
  labs(x = "Government Corruption", y = "Civil Society Participation") +
  ggtitle("Civil Society Participation vs. Government Corruption")

```
```{r Line graph}
## the line graphs look kinda weird. is there a way to make them better for time
## series or large amounts of


# Line graph of civil society participation over time
ggplot(cs, aes(x = year, y = cspart)) +
  geom_line() +
  labs(x = "Year", y = "Civil Society Participation") +
  ggtitle("Changes in Civil Society Participation over Time")

# Line graph of civil society repression effort over time
ggplot(cs, aes(x = year, y = csrepress)) +
  geom_line() +
  labs(x = "Year", y = "Civil Society Repression Effort") +
  ggtitle("Changes in Civil Society Repression Effort over Time")

# Line graph of social support over time
ggplot(cs, aes(x = year, y = social_support)) +
  geom_line() +
  labs(x = "Year", y = "Social Support") +
  ggtitle("Changes in Social Support over Time")

# Line graph of freedom to make life choices over time
ggplot(cs, aes(x = year, y = choices)) +
  geom_line() +
  labs(x = "Year", y = "Freedom to Make Life Choices") +
  ggtitle("Changes in Freedom to Make Life Choices over Time")

# Line graph of presence of war over time
ggplot(cs, aes(x = year, y = civil_war)) +
  geom_line() +
  labs(x = "Year", y = "Presence of War") +
  ggtitle("Changes in Presence of War over Time")

# Line graph of presence of coups over time
ggplot(cs, aes(x = year, y = coup)) +
  geom_line() +
  labs(x = "Year", y = "Presence of Coups") +
  ggtitle("Changes in Presence of Coups over Time")

# Line graph of participation rate in civil society over time
ggplot(cs, aes(x = year, y = v2x_partipdem)) +
  geom_line() +
  labs(x = "Year", y = "Participation Rate in Civil Society") +
  ggtitle("Changes in Participation Rate in Civil Society over Time")

# Line graph of generosity over time
ggplot(cs, aes(x = year, y = gen)) +
  geom_line() +
  labs(x = "Year", y = "Generosity") +
  ggtitle("Changes in Generosity over Time")

# Line graph of education over time
ggplot(cs, aes(x = year, y = edu)) +
  geom_line() +
  labs(x = "Year", y = "Education") +
  ggtitle("Changes in Education over Time")

# Line graph of government corruption over time
ggplot(cs, aes(x = year, y = corr)) +
  geom_line() +
  labs(x = "Year", y = "Government Corruption") +
  ggtitle("Changes in Government Corruption over Time")



```


```{r QQ plot}
# QQ plot of civil society participation
qqnorm(cs$cspart, main = "QQ Plot of Civil Society Participation")
qqline(cs$cspart)

```